# Tool Use & Front-End Actions

## 1. What “Tool Use” Means in LLM land

Large-language-models can call **external functions** when they notice that a task can’t be answered with text alone.  
Think of it as the model saying:

> “I know how to answer, but first I need someone to *open this web page* / *fetch today’s weather* / *store something in a database*.”

OpenAI calls these **“function calls” or “tool calls.”**  
Example request/response flow:

```text
User  →  "Show me the weather in Athens."
GPT   →  {name:"get_weather", arguments:{city:"Athens"}}
Your code runs get_weather() …
GPT   →  "It is 24 °C and sunny in Athens."
```

Exactly the same idea powers Gendox’s **Tool Use**.

---

## 2. How Tool Use Works in Gendox

When the agent decides to use a tool you have defined, the widget:

1. Sends a **browser `postMessage` event**  
   (`type: 'gendox.events.chat.message.tool_calls.request'`)
2. Includes a **payload** that lists every tool call the agent just made.

> **One-way for now:** the agent *tells* the browser to do something.  
> Returning data back to the agent isn’t implemented yet.

Typical use cases today:

| Tool name        | What you implement in JS | Real-world use-case                                |
|------------------|--------------------------|----------------------------------------------------|
| `open_web_page`  | `window.open(url)`       | “Open this product page in a new tab.”             |
| `set_filters`    | Update DOM / URL params  | “Show me only red shoes under €50.”                |
| `fill_form`      | Programmatically fill inputs | Speed-fill checkout or inquiry forms.          |

---

## 3. Adding Tools in the Gendox UI

1. **Open your project** → **Settings** → **AI Agent** → **Tools**
![how-to-add-tool.gif](./img/how-to-add-tool.gif)
2. Click **“Add Tool”** and paste a JSON schema identical to OpenAI’s format.

Example schema for “open web page”:

```jsonc
{
  "name": "open_web_page",
  "strict": true,
  "description": "Function to open a web page in the browser. Sends an event to the browser to open a new tab with the specified URL.",
  "parameters": {
    "type": "object",
    "required": ["url"],
    "additionalProperties": false,
    "properties": {
      "url": {
        "type": "string",
        "description": "The URL of the web page to open"
      }
    }
  }
}
```

3. **Save**.  
   From now on your agent can decide to call `open_web_page`.

---

## 4. Handling Tool Calls in Your Front End

### 4.1  Add a listener

```html
<script>
  function handleToolUseMessages(event) {
    if (
      event.data &&
      event.data.type === 'gendox.events.chat.message.tool_calls.request'
    ) {
      const toolCalls = event.data.payload;
      console.log('Tool Calls Request:', toolCalls);

      toolCalls.forEach(call => {
        switch (call.function.name) {
          case 'open_web_page':
            const { url } = JSON.parse(call.function.arguments);
            window.open(url, '_blank');
            break;

          // add more tool handlers here
          default:
            console.warn('Unknown tool:', call.function.name);
        }
      });
    }
  }

  window.addEventListener('message', handleToolUseMessages, false);
</script>
```

### 4.2  Payload format

The widget sends **an array** (you may receive multiple tool calls at once):

```json
[
  {
    "threadId": "2043baeb-873f-464a-8840-5bf32dd6856a",
    "messageId": "fe8244bf-ddc7-4ac8-9def-ff9f5163ae2f",
    "function": {
      "name": "open_web_page",
      "arguments": "{\"url\":\"https://example.com\"}"
    },
    "id": "",
    "type": "function"
  }
]
```

Field cheat-sheet:

| Field            | Meaning                                     |
|------------------|---------------------------------------------|
| `threadId`       | Chat thread the call belongs to             |
| `messageId`      | Specific message that triggered the call    |
| `function.name`  | Tool name you registered in Gendox          |
| `function.arguments` | JSON string with the parameters          |

---

## 5. Step-by-Step Recap

| Step | What you do                                                                                               |
|------|-----------------------------------------------------------------------------------------------------------|
| 1.   | Define tools in **Project → Settings → AI Agent → Tools** (OpenAI-style JSON schema).                     |
| 2.   | Deploy the usual Gendox widget `<script …>` tag on your site.                                             |
| 3.   | Add a `window.addEventListener('message', handler)` in your front-end.                                    |
| 4.   | In the handler, look for `type === 'gendox.events.chat.message.tool_calls.request'`.                      |
| 5.   | Parse `event.data.payload`, match each `function.name`, run your own JS (open tab, modify DOM, etc.).     |
| 6.   | (Future) In a later release you’ll be able to send results back to the agent.                             |

---

### 6. Gotchas & Best Practices

* **One-way only:** don’t expect a reply channel yet; perform the action and you’re done.
* **Security:** validate the arguments (`new URL(url)`, whitelists, etc.) before executing.
* **Multiple calls:** the array may contain more than one tool invocation—loop through it.
* **Versioning:** schema changes won’t break old widgets, but keep your handler switch-case up-to-date.

---

Happy building!  
With Gendox Tool Use you can turn any website from a static page into an interactive AI Agent that **navigates**, **filters**, and **controls** your site.
