"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[6203],{7066:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>s,metadata:()=>d,toc:()=>r});var a=t(4848),i=t(8453);const s={},o="Database",d={id:"Maintenance/Database-Mainentance",title:"Database",description:"Database used in Postgres v15 (to be updated to v17).",source:"@site/docs/05-Maintenance/Database-Mainentance.md",sourceDirName:"05-Maintenance",slug:"/Maintenance/Database-Mainentance",permalink:"/gendox-core/docs/Maintenance/Database-Mainentance",draft:!1,unlisted:!1,editUrl:"https://github.com/ctrl-space-labs/gendox-core/tree/main/documentation/docs/05-Maintenance/Database-Mainentance.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"_category_.json",permalink:"/gendox-core/docs/category/_category_json"}},c={},r=[{value:"Embeddings table",id:"embeddings-table",level:2},{value:"PGVector plugin",id:"pgvector-plugin",level:3},{value:"Embedding Indexes",id:"embedding-indexes",level:3}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"database",children:"Database"})}),"\n",(0,a.jsx)(n.p,{children:"Database used in Postgres v15 (to be updated to v17)."}),"\n",(0,a.jsx)(n.h2,{id:"embeddings-table",children:"Embeddings table"}),"\n",(0,a.jsx)(n.p,{children:"The most resource intensive (and most important) table in the application is the gendox_core.embeddings table.\nIt is used to store the semantic embeddings of the application. Each embedding is a double[] of size 1536 (it can be less, rarely it can be more)."}),"\n",(0,a.jsx)(n.h3,{id:"pgvector-plugin",children:"PGVector plugin"}),"\n",(0,a.jsxs)(n.p,{children:["PGVector plugin is used to manage embeddings. You can follow ",(0,a.jsx)(n.a,{href:"https://github.com/pgvector/pgvector?tab=readme-ov-file#docker-1",children:"pgvector documentation"})," on how to upgrade the plugin.\nGendox is using the Pluing's Docker image to run the whole database, so we just use the latest minor version available for Postgres."]}),"\n",(0,a.jsx)(n.h3,{id:"embedding-indexes",children:"Embedding Indexes"}),"\n",(0,a.jsxs)(n.p,{children:["Indexes are used to optimize semantic search queries. Indexes for embeddings are a special type of indexes mainly implementing semantic search. So, basically the indexes are used to ",(0,a.jsx)(n.code,{children:"LIMIT"})," the search space of the embeddings table to the top, for example 10, most relevant embeddings to the query embedding."]}),"\n",(0,a.jsxs)(n.p,{children:["The indexes used are of type ",(0,a.jsx)(n.code,{children:"HNSW"})," and are partial indexes. The partial indexes are used to limit the search space to the embeddings for a specific project-embedding model."]}),"\n",(0,a.jsx)(n.p,{children:"This way, you can easily end-up with 10.000 indexes in the same table, which we don't want to :)"}),"\n",(0,a.jsx)(n.p,{children:"In Gendox we are proposing to create a new partial index only for projects that have more than 10.000 embeddings. For the rest of the projects, we are using the default sequential scan."}),"\n",(0,a.jsx)(n.p,{children:"You can create a new partial index using the following SQL query:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"CREATE INDEX hnsw_l2_idx_proj_12345678_9abcd_443c_1234_123456789abc\n    ON gendox_core.embedding_clone\n        USING hnsw (embedding_vector vector_l2_ops)\n    WITH (\n    m = 16, -- Max number of connections per node (default: 16)\n    ef_construction = 64 -- Size of the dynamic candidate list for constructing the graph (default: 64)\n    )\n    WHERE project_id = '12345678_9abcd_443c_1234_123456789abc'  -- project id\n              and section_id is not null                        -- semantic search is applied only in sections of documents uploaded\n              and semantic_search_model_id = '[model-id]';      -- the id of model eg OpenAI text-embeddigns-3, etc\n"})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(l,{...e})}):l(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>d});var a=t(6540);const i={},s=a.createContext(i);function o(e){const n=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),a.createElement(s.Provider,{value:n},e.children)}}}]);