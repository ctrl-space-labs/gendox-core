"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[6203],{7066:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>s,metadata:()=>o,toc:()=>r});var i=t(4848),a=t(8453);const s={},d="Database",o={id:"Maintenance/Database-Mainentance",title:"Database",description:"Database used in Postgres v15 (to be updated to v17).",source:"@site/docs/05-Maintenance/Database-Mainentance.md",sourceDirName:"05-Maintenance",slug:"/Maintenance/Database-Mainentance",permalink:"/gendox-core/Maintenance/Database-Mainentance",draft:!1,unlisted:!1,editUrl:"https://github.com/ctrl-space-labs/gendox-core/tree/main/documentation/docs/05-Maintenance/Database-Mainentance.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Gendox Administrator Guide",permalink:"/gendox-core/Maintenance/Administrator-Guide"}},c={},r=[{value:"Embeddings table",id:"embeddings-table",level:2},{value:"PGVector plugin",id:"pgvector-plugin",level:3},{value:"Embedding Indexes",id:"embedding-indexes",level:3}];function l(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"database",children:"Database"})}),"\n",(0,i.jsx)(n.p,{children:"Database used in Postgres v15 (to be updated to v17)."}),"\n",(0,i.jsx)(n.h2,{id:"embeddings-table",children:"Embeddings table"}),"\n",(0,i.jsx)(n.p,{children:"The most resource intensive (and most important) table in the application is the gendox_core.embeddings table.\nIt is used to store the semantic embeddings of the application. Each embedding is a double[] of size 1536 (it can be less, rarely it can be more)."}),"\n",(0,i.jsx)(n.h3,{id:"pgvector-plugin",children:"PGVector plugin"}),"\n",(0,i.jsxs)(n.p,{children:["PGVector plugin is used to manage embeddings. You can follow ",(0,i.jsx)(n.a,{href:"https://github.com/pgvector/pgvector?tab=readme-ov-file#docker-1",children:"pgvector documentation"})," on how to upgrade the plugin.\nGendox is using the Pluing's Docker image to run the whole database, so we just use the latest minor version available for Postgres."]}),"\n",(0,i.jsx)(n.h3,{id:"embedding-indexes",children:"Embedding Indexes"}),"\n",(0,i.jsxs)(n.p,{children:["Indexes are used to optimize semantic search queries. Indexes for embeddings are a special type of indexes mainly implementing semantic search. So, basically the indexes are used to ",(0,i.jsx)(n.code,{children:"LIMIT"})," the search space of the embeddings table to the top, for example 10, most relevant embeddings to the query embedding."]}),"\n",(0,i.jsxs)(n.p,{children:["The indexes used are of type ",(0,i.jsx)(n.code,{children:"HNSW"})," and are partial indexes. The partial indexes are used to limit the search space to the embeddings for a specific project-embedding model."]}),"\n",(0,i.jsx)(n.p,{children:"This way, you can easily end-up with 10.000 indexes in the same table, which we don't want to :)"}),"\n",(0,i.jsx)(n.p,{children:"In Gendox we are proposing to create a new partial index only for projects that have more than 10.000 embeddings. For the rest of the projects, we are using the default sequential scan."}),"\n",(0,i.jsx)(n.p,{children:"You can create a new partial index using the following SQL query:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"CREATE INDEX hnsw_l2_idx_proj_12345678_9abcd_443c_1234_123456789abc\n    ON gendox_core.embedding\n        USING hnsw ((embedding_vector::vector(1536)) vector_l2_ops)\n    WITH (\n    m = 16,               -- Max connections per node (default: 16)\n    ef_construction = 64  -- Candidate list size for construction (default: 64)\n    )\n    WHERE project_id = '12345678_9abcd_443c_1234_123456789abc'\n        AND section_id IS NOT NULL\n        AND semantic_search_model_id = '[model-id]';\n"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Just replace:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"12345678_9abcd_443c_1234_123456789abc"})," with the project_id"]}),"\n",(0,i.jsxs)(n.li,{children:["index name ",(0,i.jsx)(n.code,{children:"hnsw_l2_idx_proj_12345678_9abcd_443c_1234_123456789abc"})," to include project_id (convention)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"[model-id]"})," with the model_id"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>d,x:()=>o});var i=t(6540);const a={},s=i.createContext(a);function d(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:d(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);